# Maintainer: NetSnmp Enterprise Team <safarikikandi@gmail.com>
pkgname=netsnmp-enterprise
pkgver=2.0.0
pkgrel=1
pkgdesc="Enterprise-grade network discovery tool"
arch=('any')
url="https://github.com/zane8n/netsnmp-enterprise"
license=('GPL3')
depends=('net-snmp' 'iputils' 'fping' 'parallel' 'curl')
source=("$pkgname-$pkgver.tar.gz")
sha256sums=('SKIP')

prepare() {
    cd "$srcdir/$pkgname-$pkgver"
}

build() {
    cd "$srcdir/$pkgname-$pkgver"
    make
}

package() {
    cd "$srcdir/$pkgname-$pkgver"
    
    # Install binary
    install -Dm755 netsnmp "$pkgdir/usr/bin/netsnmp"
    
    # Install man page
    install -Dm644 man/netsnmp.1 "$pkgdir/usr/share/man/man1/netsnmp.1"
    gzip "$pkgdir/usr/share/man/man1/netsnmp.1"
    
    # Install configuration
    install -Dm644 config/netsnmp.conf "$pkgdir/etc/netsnmp/netsnmp.conf"
    
    # Install documentation
    install -Dm644 docs/INSTALL.md "$pkgdir/usr/share/doc/$pkgname/INSTALL.md"
    install -Dm644 README.md "$pkgdir/usr/share/doc/$pkgname/README.md"
    
    # Create directories
    mkdir -p "$pkgdir/var/cache/netsnmp"
    mkdir -p "$pkgdir/var/log"
    
    # Set permissions
    chmod 755 "$pkgdir/var/cache/netsnmp"
}

post_install() {
    echo "NetSnmp Enterprise post-installation setup..."
    
    # Create log file if it doesn't exist
    touch /var/log/netsnmp.log
    chmod 644 /var/log/netsnmp.log
    
    echo "Post-installation setup completed successfully!"
    echo ""
    echo "Next steps:"
    echo "  1. Configure: sudo netsnmp --wizard"
    echo "  2. Scan network: sudo netsnmp --update"
    echo "  3. Search devices: netsnmp switch"
}

post_upgrade() {
    systemctl daemon-reload 2>/dev/null || true
}

pre_remove() {
    systemctl stop netsnmp.timer 2>/dev/null || true
    systemctl disable netsnmp.timer 2>/dev/null || true
}